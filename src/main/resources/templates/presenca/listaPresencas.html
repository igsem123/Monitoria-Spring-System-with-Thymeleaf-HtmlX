<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <title>Presenças por Monitoria</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Sans:ital,wght@0,100..800;1,100..800&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/output.css}"/>
</head>
<body class="bg-green-100 text-gray-800 antialiased min-h-screen flex flex-col items-center font-ubuntu">
<th:block th:replace="~{fragments/menu :: menu}"></th:block>

<div class=" w-8/12 bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-4 items-center">
    <div class="flex flex-col md:flex-row items-center justify-between mb-6">
        <img src="/images/icons/ic_presencas_v2.png" alt="Ícone Presenças" class="w-24 h-24 object-contain mr-6">
        <div class="text-center md:text-left">
            <h1 class="text-3xl font-extrabold text-green-800 mb-2">Lista de Presenças por Monitoria</h1>
            <h2 class="text-lg text-green-600">Visualize as presenças registradas para cada monitoria.</h2>
        </div>
        <div class="ml-auto">
            <button
                    hx-get="/presenca/cadastrar"
                    hx-target="#modal-container"
                    hx-trigger="click"
                    class="px-4 py-2 ml-6 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-200">
                Nova Presença
            </button>
            <div id="modal-container"></div>
        </div>
    </div>

    <th:block th:if="${!presencasPage.isEmpty()}">
        <ul class="space-y-6">
            <table class="min-w-full bg-white rounded-lg shadow-md border border-gray-200">
                <thead>
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Monitoria
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Status da
                        Monitoria
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Professor
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Monitor
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Qtde. De
                        Presenças
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Data</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">Ações
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="presenca : ${presencasPage}" class="bg-gray-50 border-b ">
                    <td class="px-6 py-4 whitespace-nowrap text-gray-800"
                        th:text="${presenca.monitoria.disciplina.nome}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-800"
                        th:text="${presenca.monitoria.status.name()}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-800"
                        th:text="${presenca.monitoria.professor.nome}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-800"
                        th:text="${presenca.monitoria.monitor.nome}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-800"
                        th:text="${presenca.qtdAlunosPresentes}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-800"
                        th:text="${#temporals.format(presenca.data, 'dd/MM/yyyy')}"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <a th:if="${presenca.monitoria.status != presenca.monitoria.status.ENCERRADA}"
                           th:href="@{/presenca/editar/{id}(id=${presenca.id})}"
                           class="text-blue-600 hover:text-blue-800 font-semibold mr-4">Editar</a>
                        <form th:action="@{/presenca/excluir(presencaId=${presenca.id})}" method="post"
                              style="display:inline;">
                            <button type="submit" class="text-red-600 hover:text-red-800 font-semibold">
                                Excluir
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </ul>

        <th:block
                th:replace="fragments/paginacao :: paginacao(${presencasPage}, '/presenca/listarPresencas')"></th:block>
    </th:block>

    <div th:fragment="formPresenca">
        <!-- Seu formulário aqui -->
    </div>

    <div th:if="${presencasPage.isEmpty()}" class="text-center text-gray-600 py-8">
        <p>Nenhuma presença encontrada.</p>
    </div>

</div>
</body>
</html>

<script>
    document.body.addEventListener('htmx:configRequest', (event) => {
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;
        const csrfToken = document.querySelector('meta[name="_csrf"]').content;
        event.detail.headers[csrfHeader] = csrfToken;
    });
</script>